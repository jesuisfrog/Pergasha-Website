"use strict";class ClassesPage extends BaseComponent{static _ascSortSubclasses(a,b){return SortUtil.ascSortLower(a.name,b.name)}static _fnSortSubclassFilterItems(c,a){return c.values.isAlwaysVisible?1:a.values.isAlwaysVisible?-1:SortUtil.listSort(c,a,{sortBy:"shortName"})}static getBtnTitleSubclass(a){const b=a.isReprinted?" (this subclass has been reprinted in a more recent source)":"";return`${a.name}; Source: ${Parser.sourceJsonToFull(a.source)}${a.page?`, page ${a.page}`:""}${b}`}static getBaseShortName(a){const b=new RegExp(`\\((UA|${a.source})\\)$`);return a.shortName.trim().replace(b,"").trim()}constructor(){super(),this.__classId={_:0},this._classId=this._getProxy("classId",this.__classId),this._list=null,this._ixData=0,this._dataList=[],this._lastScrollFeature=null,this._outlineData={},this._pageFilter=new PageFilterClasses,this._listSubclass=null,this._ixDataSubclass=0,this._fnTableHandleFilterChange=null,this._$wrpOutline=null,this._fnOutlineHandleFilterChange=null,this._$trsContent=[],this._$trNoContent=null,this._subclassComparisonView=null,this._classBookView=null}get activeClass(){return this._dataList[this._classId._]}get filterBox(){return this._pageFilter.filterBox}async pOnLoad(){await ExcludeUtil.pInitialise(),Omnisearch.addScrollTopFloat();const a=await DataUtil.class.loadJSON();this._list=ListUtil.initList({listClass:"classes",isUseJquery:!0}),ListUtil.setOptions({primaryLists:[this._list]}),SortUtil.initBtnSortHandlers($("#filtertools"),this._list),await this._pageFilter.pInitFilterBox({$iptSearch:$(`#lst__search`),$wrpFormTop:$(`#filter-search-group`).title("Hotkey: f"),$btnReset:$(`#reset`)}),this._addData(a),BrewUtil.bind({filterBox:this.filterBox,sourceFilter:this._pageFilter.sourceFilter,list:this._list,pHandleBrew:this._pHandleBrew.bind(this)});const b=await BrewUtil.pAddBrewData();await this._pHandleBrew(b),await BrewUtil.pAddLocalBrewData(),BrewUtil.makeBrewButton("manage-brew"),await ListUtil.pLoadState(),RollerUtil.addListRollButton(!0),window.onhashchange=this._handleHashChange.bind(this),this._list.init(),$(`.initial-message`).text(`Select a class from the list to view it here`),this._setClassFromHash(Hist.initialLoad),this._setStateFromHash(Hist.initialLoad),await this._pInitAndRunRender(),ExcludeUtil.checkShowAllExcluded(this._dataList,$(`#pagecontent`)),this._initLinkGrabbers(),UrlUtil.bindLinkExportButton(this.filterBox,$(`#btn-link-export`)),Hist.initialLoad=!1,this._setHashFromState(!0),window.dispatchEvent(new Event("toolsLoaded"))}async _pHandleBrew(a){const{class:b,subclass:c}=a,d=MiscUtil.copy({class:b,subclass:c});if(d.class)for(let a=0;a<d.class.length;++a)d.class[a]=await DataUtil.class.pGetDereferencedClassData(d.class[a]);if(d.subclass)for(let a=0;a<d.subclass.length;++a)d.subclass[a]=await DataUtil.class.pGetDereferencedSubclassData(d.subclass[a]);const{isAddedAnyClass:e,isAddedAnySubclass:f}=this._addData(d);f&&!Hist.initialLoad&&(await this._pDoRender())}_addData(a){let b=!1,c=!1;return a.class&&a.class.length&&(b=!0)&&this._addData_addClassData(a.class),a.subclass&&a.subclass.length&&(c=!0)&&this._addData_addSubclassData(a.subclass),(b||c)&&(this._list.update(),this.filterBox.render(),this._handleFilterChange(),ListUtil.setOptions({itemList:this._dataList,primaryLists:[this._list]})),{isAddedAnyClass:b,isAddedAnySubclass:c}}_addData_addClassData(a){a.forEach(a=>{this._pageFilter.mutateForFilters(a);const b=ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"class",a.source),c={};(a.subclasses||[]).forEach(a=>{b||((c[a.source]=c[a.source]||{})[a.name]=c[a.source][a.name]||ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"subclass",a.source))}),this._pageFilter.addToFilters(a,b,{subclassExclusions:c})}),a.filter(a=>SourceUtil.isNonstandardSource(a.source)||BrewUtil.hasSourceJson(a.source)).forEach(a=>{a.fluff&&a.fluff.filter(b=>b.source===a.source).forEach(a=>a._isStandardSource=!0),a.subclasses.filter(b=>b.source===a.source).forEach(a=>a._isStandardSource=!0)}),a.filter(a=>a.subclasses).forEach(a=>a.subclasses.sort(ClassesPage._ascSortSubclasses)),this._dataList.push(...a);for(const b=this._dataList.length;this._ixData<b;this._ixData++){const a=this._dataList[this._ixData],b=ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"class",a.source);this._list.addItem(this.getListItem(a,this._ixData,b))}}_addData_addSubclassData(a){let b;Hist.initialLoad||(b=!this._pageFilter.sourceFilter.getValues()._isActive),a.forEach(a=>{const b=this._dataList.find(b=>b.name.toLowerCase()===a.className.toLowerCase()&&b.source.toLowerCase()===(a.classSource||SRC_PHB).toLowerCase());if(!b)return void JqueryUtil.doToast({content:`Could not add subclass; could not find class with name: ${b.class} and source ${a.source||SRC_PHB}`,type:"danger"});const c=a.uniqueId?b.subclasses.find(b=>b.uniqueId===a.uniqueId):null;if(!c){const c=ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](b),"class",b.source);b.subclasses.push(a),this._pageFilter.mutateAndAddToFilters(b,c),b.subclasses.sort(ClassesPage._ascSortSubclasses)}}),b&&this._pageFilter.sourceFilter.doSetPillsClear()}_initHashAndStateSync(){this._resetHooks("state"),this._resetHooksAll("state"),this._resetHooks("classId"),this._addHookAll("state",()=>this._setHashFromState())}_setHashFromState(a){a===void 0&&(a=Hist.initialLoad);const b=this._getHashState(),c=window.location.hash,d="#"===c[0]?c.slice(1):c;b!==d&&(a?Hist.replaceHistoryHash(b):window.location.hash=b)}_handleHashChange(){return Hist.isHistorySuppressed?Hist.setSuppressHistory(!1):void(this._setClassFromHash(),this._setStateFromHash())}_setClassFromHash(a){const[b]=Hist.getHashParts();let c;if(b===HASH_BLANK)c=-1;else{const a=Hist.getActiveListItem(b);if(null==a)c=-1;else{const b=a.ix;c=null==b?-1:a.ix}}if(!~c&&this._list.visibleItems.length&&(c=this._list.visibleItems[0].ix),~c){const b=a?this.__classId:this._classId;if(b._!==c){Hist.lastLoadedId=c;const a=this._dataList[c];document.title=`${a?a.name:"Classes"} - 5etools`,b._=c}}else $(`#pagecontent`).empty().append(ClassesPage._render_$getTrNoContent()),JqueryUtil.doToast({content:"Could not find the class to load!",type:"error"})}_setStateFromHash(a){let[b,...c]=Hist.getHashParts();c=this.filterBox.setFromSubHashes(c);const d=a?this.__state:this._state;if(c.length||(this.__state.feature=null),this._getHashState()===c.join(HASH_PART_SEP))return;const e=this.activeClass,f={};e.subclasses.forEach(a=>f[UrlUtil.getStateKeySubclass(a)]=a);const g=new Set,h=new Set;if(c.forEach(a=>{const b=UrlUtil.unpackSubHash(a);b.state&&b.state.map(a=>{let[b,c]=a.split("=");if(b=b.toLowerCase(),c=UrlUtil.mini.decompress(c),b.startsWith("sub"))f[b]&&(d[b]!==c&&(d[b]=c),g.add(f[b].source),h.add(b));else{const a=Object.keys(ClassesPage._DEFAULT_STATE).find(a=>a.toLowerCase()===b);a&&(d[a]!==c&&(d[a]=c),h.add(a))}})}),Object.entries(ClassesPage._DEFAULT_STATE).forEach(([a,b])=>{h.has(a)||b===d[a]||(d[a]=b)}),g.size){const a=this._pageFilter.sourceFilter.getValues().Source;a._isActive&&(0<a._totals.yes?g.forEach(a=>this._pageFilter.sourceFilter.setValue(a,1)):g.forEach(b=>{0!==a[b]&&this._pageFilter.sourceFilter.setValue(b,0)}))}Object.keys(f).forEach(a=>{!h.has(a)&&d[a]&&(d[a]=!1)}),a||this._setHashFromState()}_getHashState(a){a=a||{};let b=a.state||MiscUtil.copy(this.__state),c=a.class||this.activeClass,d=c?UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](c):null;if(!d){const a=this._list.items[0];d=a?a.values.hash:HASH_BLANK}const e=c.subclasses.map(a=>UrlUtil.getStateKeySubclass(a)),f=Object.entries(b).filter(([a,b])=>ClassesPage._DEFAULT_STATE[a]!==b).filter(([a,b])=>ClassesPage._DEFAULT_STATE[a]!==void 0||b).filter(([a])=>!a.startsWith("sub")||e.includes(a)).map(([a,b])=>`${a}=${UrlUtil.mini.compress(b)}`),g=f.length?UrlUtil.packSubHash("state",f):"",h=[d,g].filter(Boolean);return Hist.util.getCleanHash(h.join(HASH_PART_SEP))}_initLinkGrabbers(){const a=$(document.body);a.on(`mousedown`,`.cls-main__linked-titles > td > * > .rd__h .entry-title-inner`,a=>a.preventDefault()),a.on(`click`,`.cls-main__linked-titles > td > * > .rd__h .entry-title-inner`,async a=>{const b=$(a.target);if(a.shiftKey)await MiscUtil.pCopyTextToClipboard(b.text().replace(/\.$/,"")),JqueryUtil.showCopiedEffect(b);else{const a=b.closest(`tr`).attr("data-scroll-id"),c=MiscUtil.copy(this.__state);c.feature=a;const d=`${window.location.href.split("#")[0]}#${this._getHashState({state:c})}`;await MiscUtil.pCopyTextToClipboard(d),JqueryUtil.showCopiedEffect(b,"Copied link!")}})}getListItem(a,b,c){const d=UrlUtil.autoEncodeHash(a),e=Parser.sourceJsonToAbv(a.source),f=$(`<a href="#${d}" class="lst--border">
			<span class="bold col-8 pl-0">${a.name}</span>
			<span class="col-4 text-center ${Parser.sourceJsonToColor(a.source)} pr-0" title="${Parser.sourceJsonToFull(a.source)}" ${BrewUtil.sourceJsonToStyle(a.source)}>${e}</span>
		</a>`),g=$$`<li class="row ${c?"row--blacklisted":""}">${f}</li>`;return new ListItem(b,g,a.name,{hash:d,source:e},{$lnk:f,entity:a,uniqueId:a.uniqueId?a.uniqueId:b,isExcluded:c})}_handleFilterChange(){const a=this.filterBox.getValues();this._list.filter(b=>this._pageFilter.toDisplay(a,b.data.entity)),this._$trsContent.forEach(b=>{b.find(`[data-source]`).each((b,c)=>{const d=c.dataset.source;$(c).toggleClass("hidden",!this.filterBox.toDisplay(a,d,[]))})}),this._fnOutlineHandleFilterChange&&this._fnOutlineHandleFilterChange(),this._fnTableHandleFilterChange&&this._fnTableHandleFilterChange(a),this._proxyAssign("state","_state","__state",this.activeClass.subclasses.filter(b=>!this.filterBox.toDisplay(a,b.source,b._fMisc)).map(a=>UrlUtil.getStateKeySubclass(a)).filter(a=>this._state[a]).mergeMap(a=>({[a]:!1})))}async _pInitAndRunRender(){this._$wrpOutline=$(`#sticky-nav`),this._addHookAll("classId",async()=>{await this._pLock("render");try{await this._pDoRender()}finally{this._unlock("render")}}),await this._pDoRender()}async _pDoRender(){this._initHashAndStateSync(),$(this.filterBox).off(FilterBox.EVNT_VALCHANGE).on(FilterBox.EVNT_VALCHANGE,this._handleFilterChange.bind(this));const a=()=>{setTimeout(()=>{this._list.items.filter(a=>a.data.$lnk).forEach(a=>{const b=`#${this._getHashState({class:a.data.entity})}`;a.data.$lnk.attr("href",b)})},5)};this._addHook("classId","_",a),this._addHookAll("state",a),a(),this._render_renderClassTable(),this._render_renderSidebar(),await this._render_pRenderSubclassTabs(),this._render_renderClassContent(),this._render_renderOutline(),this._render_renderAltViews();const b=()=>{if(this._state.feature){if(this._lastScrollFeature===this._state.feature)return;this._lastScrollFeature=this._state.feature;const a=$(`[data-scroll-id="${this._state.feature}"]`);a[0]?setTimeout(()=>a[0].scrollIntoView(),100):(this._state.feature=null,this._lastScrollFeature=null)}};this._addHookBase("feature",b),b();const c=()=>$(`.cls-main__cls-fluff`).toggleClass("hidden",!this._state.isShowFluff);this._addHookBase("isShowFluff",c),MiscUtil.pDefer(c);const d=()=>{const a=$(`[data-feature-type="class"]`),b=$(`[data-feature-type="gain-subclass"]`);this._state.isHideFeatures?this._isAnySubclassActive()?(this._$wrpOutline.toggleClass("hidden",!1),this._$trNoContent.toggleClass("hidden",!0),a.toggleClass("hidden",!0),b.toggleClass("hidden",!1)):(this._$wrpOutline.toggleClass("hidden",!0),this._$trNoContent.toggleClass("hidden",!1),a.toggleClass("hidden",!0),b.toggleClass("hidden",!0)):(this._$wrpOutline.toggleClass("hidden",!1),this._$trNoContent.toggleClass("hidden",!0),a.toggleClass("hidden",!1),b.toggleClass("hidden",!1))};this._addHookBase("isHideFeatures",d),MiscUtil.pDefer(d);const e=this.activeClass;e.subclasses.forEach(a=>{const b=UrlUtil.getStateKeySubclass(a),c=()=>{const a=this._state[b];$(`[data-subclass-id="${b}"]`).toggleClass("hidden",!a)};this._addHookBase(b,c),this._addHookBase(b,d),MiscUtil.pDefer(c)}),this._handleFilterChange()}_isAnySubclassActive(){return!!this._getActiveSubclasses().length}_getActiveSubclasses(a){const b=this.activeClass;return b.subclasses.filter(a=>this._state[UrlUtil.getStateKeySubclass(a)]).map(b=>a?UrlUtil.getStateKeySubclass(b):b)}_render_renderClassTable(){const a=$(`#classtable`).empty(),b=this.activeClass;Renderer.get().resetHeaderIndex();const c=[],d=[],e=(a,b)=>{let e;e=a.title?$(`<th class="cls-tbl__col-group" colspan="${a.colLabels.length}">${a.title}</th>`):$(`<th colspan="${a.colLabels.length}"/>`),c.push(e);const f=[];if(a.colLabels.forEach(a=>{const b=$(`<th class="cls-tbl__col-generic-center"><div class="cls__squash_header"/></th>`).fastSetHtml(Renderer.get().render(a));f.push(b),d.push(b)}),!!b){const a=()=>{e.toggleClass("hidden",!this._state[b]),f.forEach(a=>a.toggleClass("hidden",!this._state[b]))};this._addHookBase(b,a),MiscUtil.pDefer(a)}};b.classTableGroups&&b.classTableGroups.forEach(a=>e(a)),b.subclasses.forEach(a=>{if(!a.subclassTableGroups)return;const b=UrlUtil.getStateKeySubclass(a);a.subclassTableGroups.forEach(a=>e(a,b))});const f=b.classFeatures.map((a,c)=>{var d=Math.ceil;const e=d((c+1)/4)+1,f=a.filter(a=>a.name&&"inset"!==a.type),g=f.map((a,b)=>{const d=`${c}-${b}`,e=$(`<a>${a.name}</a>`).click(()=>{this._lastScrollFeature=null,this._state.feature=null,this._state.feature=d}),g=()=>{setTimeout(()=>{const a=MiscUtil.copy(this.__state);a.feature=d;const b=`#${this._getHashState({state:a})}`;e.attr("href",b)},5)};this._addHookAll("state",g),g();const h=b===f.length-1?$(`<span/>`):$(`<span class="mr-1">,</span>`);return{$wrpLink:$$`<div class="inline-block">${e}${h}</div>`,$dispComma:h,source:a.source,isHidden:!1}}),h=[],i=(a,b)=>{const d=a.rows[c]||[],e=d.map(a=>$(`<td class="cls-tbl__col-generic-center"/>`).fastSetHtml(0===a?"\u2014":Renderer.get().render(a)));if(h.push(...e),!!b){const a=()=>e.forEach(a=>a.toggleClass("hidden",!this._state[b]));this._addHookBase(b,a),MiscUtil.pDefer(a)}};return b.classTableGroups&&b.classTableGroups.forEach(a=>i(a)),b.subclasses.forEach(a=>{if(!a.subclassTableGroups)return;const b=UrlUtil.getStateKeySubclass(a);a.subclassTableGroups.forEach(a=>i(a,b))}),{$row:$$`<tr class="cls-tbl__stripe-odd">
					<td class="cls-tbl__col-level">${Parser.getOrdinalForm(c+1)}</td>
					<td class="cls-tbl__col-prof-bonus">+${e}</td>
					<td>${g.length?g.map(a=>a.$wrpLink):`\u2014`}</td>
					${h}
				</tr>`,metasFeatureLinks:g}});this._fnTableHandleFilterChange=a=>{f.forEach(b=>{b.metasFeatureLinks.forEach(b=>{if(b.source){const c=!this.filterBox.toDisplay(a,b.source,[]);b.isHidden=c,b.$wrpLink.toggleClass("hidden",c)}}),b.metasFeatureLinks.forEach(a=>a.$dispComma.toggleClass("hidden",!1));const c=b.metasFeatureLinks.filter(a=>!a.isHidden).last();c&&c.$dispComma.addClass("hidden")})},$$`<table class="cls-tbl shadow-big w-100 mb-2">
			<tbody>
			<tr><th class="border" colspan="15"></th></tr>
			<tr><th class="cls-tbl__disp-name" colspan="15">${b.name}</th></tr>
			<tr>
				<th colspan="3"/> <!-- spacer to match the 3 default cols (level, prof, features) -->
				${c}
			</tr>
			<tr>
				<th class="cls-tbl__col-level">Level</th>
				<th class="cls-tbl__col-prof-bonus">Proficiency Bonus</th>
				<th>Features</th>
				${d}
			</tr>
			${f.map(a=>a.$row)}
			<tr><th class="border" colspan="15"></th></tr>
			</tbody>
		</table>`.appendTo(a),a.show()}_render_renderSidebar(){const a=$(`#statsprof`).empty(),b=this.activeClass,c=$(`<div class="cls-side__btn-toggle">[\u2012]</div>`).click(()=>this._state.isHideSidebar=!this._state.isHideSidebar),d=()=>{c.text(this._state.isHideSidebar?`[+]`:`[\u2012]`),$(`.cls-side__show-hide`).toggle(!this._state.isHideSidebar)};this._addHookBase("isHideSidebar",d);const e=(a,b=null)=>{const c=(a,b=", ")=>Object.keys(a).filter(a=>Parser.ABIL_ABVS.includes(a)).sort(SortUtil.ascSortAtts).map(b=>`${Parser.attAbvToFull(b)} ${a[b]}`).join(b),d=a.or?a.or.map(a=>c(a," or ")).join("; "):"",e=c(a),f=[d,e].filter(Boolean).join("; "),g=[f?`{@b Ability Score Minimum:} ${f}`:null,...(a.entries||[])].filter(Boolean);return $$`<div>${Renderer.get().setFirstSection(!0).render({type:"section",entries:g})}</div>`};let f=null;if(b.requirements){const a=e(b.requirements);f=$$`<tr class="cls-side__show-hide">
				<td class="cls-side__section" colspan="6">
					<h5 class="cls-side__section-head">Prerequisites</h5>
					${a}
				</td>
			</tr>`}let g=null;if(b.hd){const a={toRoll:`${b.hd.number}d${b.hd.faces}`,rollable:!0};g=`<tr class="cls-side__show-hide">
				<td colspan="6" class="cls-side__section">
					<h5 class="cls-side__section-head">Hit Points</h5>
					<div><strong>Hit Dice:</strong> ${Renderer.getEntryDice(a,"Hit die")}</div>
					<div><strong>Hit Points at 1st Level:</strong> ${b.hd.number*b.hd.faces} + your Constitution modifier</div>
					<div><strong>Hit Points at Higher Levels:</strong> ${Renderer.getEntryDice(a,"Hit die")} (or ${b.hd.number*b.hd.faces/2+1}) + your Constitution modifier per ${b.name} level after 1st</div>
				</td>
			</tr>`}const h=a=>a.map(b=>b.full?b.full:"light"===b||"medium"===b||"heavy"===b?`${b} armor`:b).join(", "),i=a=>a.map(a=>"simple"===a||"martial"===a?`${a} weapons`:a).join(", "),j=a=>a.map(a=>Renderer.get().render(a)).join(", "),k=a=>`${Parser.skillProficienciesToFull(a).uppercaseFirst()}.`,l=b.startingProficiencies||{};let m=null;if(b.startingEquipment){const a=b.startingEquipment,c=[a.additionalFromBackground?"<p>You start with the following items, plus anything provided by your background.</p>":"",a.default&&a.default.length?`<ul class="pl-4"><li>${a.default.map(a=>Renderer.get().render(a)).join("</li><li>")}</ul>`:"",null==a.goldAlternative?"":`<p>Alternatively, you may start with ${Renderer.get().render(a.goldAlternative)} gp to buy your own equipment.</p>`].filter(Boolean).join(""),d=$(`<div/>`);m=$$`<tr class="cls-side__show-hide">
				<td class="cls-side__section" colspan="6">
					<h5 class="cls-side__section-head">Starting Equipment</h5>
					<div>${d}</div>
				</td>
			</tr>`,d.fastSetHtml(c)}let n=null;if(b.multiclassing){const a=b.multiclassing,c=a.requirements||a.requirementsSpecial?`<div>To qualify for a new class, you must meet the ${a.requirementsSpecial?"":"ability score "}prerequisites for both your current class and your new one.</div>`:"";let d=null;a.requirements&&(d=e(a.requirements,c));let f=null;a.requirementsSpecial&&(f=$$`<div>
					${a.requirements?"":c}
					<b>${a.requirements?"Other ":""}Prerequisites:</b> ${Renderer.get().render(a.requirementsSpecial||"")}
				</div>`);let g=null,l=null,m=null,o=null,p=null;a.proficienciesGained&&(g=$(`<div ${a.requirements||a.requirementsSpecial?`class="cls-side__mc-prof-intro--requirements"`:""}>When you gain a level in a class other than your first, you gain only some of that class's starting proficiencies.</div>`),a.proficienciesGained.armor&&(l=$(`<div><b>Armor:</b> ${h(a.proficienciesGained.armor)}</div>`)),a.proficienciesGained.weapons&&(m=$(`<div><b>Weapons:</b> ${i(a.proficienciesGained.weapons)}</div>`)),a.proficienciesGained.tools&&(o=$(`<div><b>Tools:</b> ${j(a.proficienciesGained.tools)}</div>`)),a.proficienciesGained.skills&&(p=$(`<div><b>Skills:</b> ${k(a.proficienciesGained.skills)}</div>`)));let q=null;a.entries&&(q=$(`<div></div>`).fastSetHtml(Renderer.get().setFirstSection(!0).render({type:"section",entries:a.entries}))),n=$$`<tr class="cls-side__show-hide">
				<td class="cls-side__section" colspan="6">
					<h5 class="cls-side__section-head">Multiclassing</h5>
					${d}
					${f}
					${q}
					${g}
					${l}
					${m}
					${o}
					${p}
				</td>
			</tr>`}$$`<table class="stats shadow-big">
			<tr><th class="border" colspan="6"></th></tr>
			<tr><th colspan="6"><div class="split-v-center pr-1"><div class="cls-side__name">${b.name}</div>${c}</div></th></tr>
			${b.authors?`<tr><th colspan="6">By ${b.authors.join(", ")}</th></tr>`:""}

			${f}

			${g}

			<tr class="cls-side__show-hide">
				<td colspan="6" class="cls-side__section">
					<h5 class="cls-side__section-head">Proficiencies</h5>
					<div><b>Armor:</b> <span>${l.armor?h(l.armor):"none"}</span></div>
					<div><b>Weapons:</b> <span>${l.weapons?i(l.weapons):"none"}</span></div>
					<div><b>Tools:</b> <span>${l.tools?j(l.tools):"none"}</span></div>
					<div><b>Saving Throws:</b> <span>${b.proficiency?b.proficiency.map(a=>Parser.attAbvToFull(a)).join(", "):"none"}</span></div>
					<div><b>Skills:</b> <span>${l.skills?k(l.skills):"none"}</span></div>
				</td>
			</tr>

			${m}

			${n}

			<tr><th class="border" colspan="6"></th></tr>
		</table>`.appendTo(a),a.show(),MiscUtil.pDefer(d)}async _render_pRenderSubclassTabs(){const a=$(`#subclasstabs`).empty();this._render_renderSubclassPrimaryControls(a),await this._render_pInitSubclassControls(a)}_render_renderSubclassPrimaryControls(a){const b=this.activeClass,c=ComponentUiUtil.$getBtnBool(this,"isHideFeatures",{text:"Features",activeClass:"cls__btn-cf--active",isInverted:!0}).title("Toggle Class Features"),d=ComponentUiUtil.$getBtnBool(this,"isShowFluff",{text:"Info"}).title("Toggle Class Info");$$`<div class="flex-v-center m-1 btn-group mr-3 no-shrink">${c}${d}</div>`.appendTo(a);const e=$(`<div class="flex-v-center flex-wrap mr-2 w-100"/>`).appendTo(a);for(this._listSubclass=new List({$wrpList:e,isUseJquery:!0,fnSort:ClassesPage._fnSortSubclassFilterItems}),this._ixDataSubclass=0;this._ixDataSubclass<b.subclasses.length;++this._ixDataSubclass){const a=b.subclasses[this._ixDataSubclass],c=this._render_getSubclassTab(b,a,this._ixDataSubclass);c&&this._listSubclass.addItem(c)}const f=$(`<div class="text-muted m-1 cls-tabs__sc-not-shown flex-vh-center"/>`);this._listSubclass.addItem(new ListItem(-1,f,null,{isAlwaysVisible:!0})),this._listSubclass.on("updated",()=>{if(f.off("click"),this._listSubclass.visibleItems.length){const a=this._listSubclass.items.length-this._listSubclass.visibleItems.length;f.html(a?`<i class="clickable" title="Adjust your filters to see more.">(${a} more not shown)</i>`:"").click(()=>this._doSelectAllSubclasses())}else 1<this._listSubclass.items.length?f.html(`<i class="clickable" title="Adjust your filters to see more.">(${this._listSubclass.items.length-1} subclasses not shown)</i>`).click(()=>this._doSelectAllSubclasses()):f.html("")}),this._listSubclass.init()}_doSelectAllSubclasses(){const a=this.activeClass,b=a.subclasses.map(a=>UrlUtil.getStateKeySubclass(a));this._pageFilter.sourceFilter.doSetPillsClear(),this.filterBox.fireChangeEvent(),this._proxyAssign("state","_state","__state",b.mergeMap(a=>({[a]:!0})))}async _render_pInitSubclassControls(a){const b=this.activeClass,c=$(`<button class="btn btn-xs btn-default" title="Select All (SHIFT to include most recent UA/etc.; CTRL to select official only)"><span class="glyphicon glyphicon-check"/></button>`).click(a=>{const c=b.subclasses.map(a=>UrlUtil.getStateKeySubclass(a));if(a.shiftKey)this._doSelectAllSubclasses();else if(a.ctrlKey||a.metaKey){const a={};c.forEach(b=>a[b]=!1),this._listSubclass.visibleItems.filter(a=>"brew"===a.values.mod||"fresh"===a.values.mod).map(a=>a.values.stateKey).forEach(b=>a[b]=!0),this._proxyAssign("state","_state","__state",a)}else{const a={};c.forEach(b=>a[b]=!1),this._listSubclass.visibleItems.map(a=>a.values.stateKey).filter(Boolean).forEach(b=>a[b]=!0),this._proxyAssign("state","_state","__state",a)}}),d=[{name:"View Official",subHashes:[],isClearSources:!1},{name:"View Most Recent",subHashes:[],isClearSources:!0},{name:"View All",subHashes:["flstmiscellaneous:reprinted=0"],isClearSources:!0}],e=a=>{const b=d[a],c=this.filterBox.getBoxSubHashes()||[],e=MiscUtil.copy(b.subHashes);if(b.isClearSources){const a=this._pageFilter.sourceFilter.getSources(),b=[...a.official,...a.homebrew].map(a=>`${a.toUrlified()}=0`).join(HASH_SUB_LIST_SEP);e.push(`flstsource:${b}`)}this.filterBox.setFromSubHashes([...c,...e,`flopsource:extend`].filter(Boolean),!0),f.val("-1")},f=$(`<select class="input-xs form-control cls-tabs__sel-preset"><option value="-1" disabled>Filter...</option></select>`).change(()=>{const a=+f.val();null==a||e(a)});d.forEach((a,b)=>f.append(`<option value="${b}">${a.name}</option>`)),f.val("-1");const g=$(`<button class="btn btn-xs btn-default" title="Reset Selection"><span class="glyphicon glyphicon-refresh"/></button>`).click(()=>{this._proxyAssign("state","_state","__state",b.subclasses.mergeMap(a=>({[UrlUtil.getStateKeySubclass(a)]:!1})))});$(this.filterBox).on(FilterBox.EVNT_VALCHANGE,this._handleSubclassFilterChange.bind(this)),this._handleSubclassFilterChange(),this._listSubclass.items.forEach(a=>a.ele.removeClass("hidden"));const h=ComponentUiUtil.$getBtnBool(this,"isShowScSources",{$ele:$(`<button class="btn btn-xs btn-default flex-1" title="Show Subclass Sources"><span class="glyphicon glyphicon-book"/></button>`)}),i=$(`<button title="Feeling Lucky?" class="btn btn-xs btn-default flex-1"><span class="glyphicon glyphicon-random"/></button>`).click(()=>{if(!this._listSubclass.visibleItems.length)return JqueryUtil.doToast({content:"No subclasses to choose from!",type:"warning"});const a=()=>this._listSubclass.items.filter(a=>a.values.stateKey).forEach(a=>this._state[a.values.stateKey]=!1),b=Object.keys(this._state).filter(a=>a.startsWith("sub")),c=this._listSubclass.visibleItems.filter(a=>a.values.stateKey).map(a=>a.values.stateKey).filter(a=>b.includes(a));if(1===c.length){a();const b=this._listSubclass.visibleItems.filter(a=>a.values.stateKey).map(a=>a.values.stateKey).filter(a=>a.values.stateKey!==c[0]);this._state[RollerUtil.rollOnArray(b)]=!0}else{a();const b=RollerUtil.rollOnArray(this._listSubclass.visibleItems.filter(a=>a.values.stateKey));this._state[b.values.stateKey]=!0}});$$`<div class="flex-v-center m-1 no-shrink">${f}</div>`.appendTo(a),$$`<div class="flex-v-center m-1 btn-group no-shrink">
			${c}${i}${g}${h}
		</div>`.appendTo(a)}_handleSubclassFilterChange(){const a=this.filterBox.getValues(),b=this.activeClass;this._listSubclass.filter(b=>!!b.values.isAlwaysVisible||this.filterBox.toDisplay(a,b.data.entity.source,b.data.entity._fMisc))}_render_getSubclassTab(a,b,c){const d=ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](b),"subclass",b.source),e=UrlUtil.getStateKeySubclass(b),f=ClassesPage.getSubclassCssMod(a,b);null==this._state[e]&&(this._state[e]=!1);const g=$(`<div title="${ClassesPage.getBtnTitleSubclass(b)}"/>`),h=$(`<div class="ml-1" title="${Parser.sourceJsonToFull(b.source)}">(${Parser.sourceJsonToAbv(b.source)})</div>`),i=()=>{g.text(this._state.isShowScSources?ClassesPage.getBaseShortName(b):b.shortName),h.toggleClass("hidden",!this._state.isShowScSources)};this._addHookBase("isShowScSources",i),MiscUtil.pDefer(i);const j=$$`<button class="btn btn-default btn-xs flex-v-center m-1 hidden ${b.isReprinted?"cls__btn-sc--reprinted":""}">
				${g}
				${h}
			</button>`.click(()=>this._state[e]=!this._state[e]).contextmenu(a=>{a.preventDefault(),this._state[e]=!this._state[e]}),k=()=>j.toggleClass(`cls__btn-sc--active-${f}`,!!this._state[e]);return this._addHookBase(e,k),MiscUtil.pDefer(k),new ListItem(c,j,b.name,{source:b.source,shortName:b.shortName,stateKey:e,mod:f},{isExcluded:d,entity:b,uniqueId:b.uniqueId?b.uniqueId:c})}_trackOutlineFluffData(a){this._outlineData.fluff=a}_trackOutlineCfData(a,b,c){((this._outlineData.classFeatures=this._outlineData.classFeatures||[])[a]=this._outlineData.classFeatures[a]||[])[b]=c}_trackOutlineScData(a,b,c,d){((this._outlineData[a]=this._outlineData[a]||[])[b]=this._outlineData[a][b]||[])[c]=d}_render_renderOutline(){this._$wrpOutline.empty();const a=$(`<div class="cls-nav__disp-toggle"/>`),b=$$`<div class="cls-nav__head-inner split">
			<div>Outline</div>
			${a}
		</div>`.click(()=>this._state.isHideOutline=!this._state.isHideOutline),c=$$`<div class="cls-nav__head">
			${b}
			<hr class="cls-nav__hr">
		</div>`.appendTo(this._$wrpOutline),d=$(`<div class="nav-body"/>`).appendTo(this._$wrpOutline),e=()=>{c.toggleClass("cls-nav__head--active",!this._state.isHideOutline),d.toggleClass("hidden",!!this._state.isHideOutline),a.toggleClass("cls-nav__disp-toggle--active",!this._state.isHideOutline)};this._addHookBase("isHideOutline",e),MiscUtil.pDefer(e);const f=MiscUtil.debounce(async()=>{await this._pLock("render-outline"),d.empty();const a=this.filterBox.getValues(),b=(b,c)=>{var e=Math.min;if(!(2<=b.depth)&&(!b.source||this.filterBox.toDisplay(a,b.source,[]))){c=(b.source&&SourceUtil.isNonstandardSource(b.source)?`cls-nav__item--spicy`:"")||c;const a=e(b.depth+1,2);$(`<div class="cls-nav__item cls-nav__item--depth-${a} ${c}">${b.name}</div>`).click(()=>{const a=$(`[data-title-index="${b.ixHeader}"]`);a.get()[0]&&a.get()[0].scrollIntoView()}).appendTo(d)}};if(this._state.isShowFluff&&this._outlineData.fluff&&this._outlineData.fluff.filter(a=>a.name).forEach(a=>b(a)),this._state.isHideFeatures&&!this._isAnySubclassActive())return void this._unlock("render-outline");let c=0;this.activeClass.classFeatures.forEach((a,d)=>{a.forEach((a,e)=>{const f=MiscUtil.get(this._outlineData.classFeatures,d,e);!this._state.isHideFeatures&&f&&f.filter(a=>a.name).forEach(a=>b(a));const g=this._getActiveSubclasses(!0);a.gainSubclassFeature&&(g.length&&(this._state.isHideFeatures&&f&&f.filter(a=>a.name).forEach(a=>b(a)),this.activeClass.subclasses.forEach(a=>{const d=UrlUtil.getStateKeySubclass(a);if(!g.includes(d))return;const e=a.subclassFeatures[c];if(!e)return;const f=ClassesPage.getSubclassCssMod(this.activeClass,a);e.forEach((a,e)=>{const g=MiscUtil.get(this._outlineData,d,c,e);g.filter(a=>a.name).map(a=>b(a,`cls-nav__item--sc-${f}`))})})),c++)})}),this._unlock("render-outline")},50);this._addHookBase("isShowFluff",f),this._addHookBase("isHideFeatures",f),this.activeClass.subclasses.forEach(a=>{const b=UrlUtil.getStateKeySubclass(a);this._addHookBase(b,f)}),this._fnOutlineHandleFilterChange=f,MiscUtil.pDefer(f)}_render_renderAltViews(){const a=this.activeClass;this._subclassComparisonView=new BookModeView({stateKey:"isViewActiveScComp",state:this._state,$openBtn:$(`#btn-comparemode`),noneVisibleMsg:"Please select some subclasses first",pageTitle:"Subclass Comparison",isFlex:!0,popTblGetNumShown:b=>{b.removeClass("bkmv__wrp").addClass("h-100").addClass("flex-col"),b.parent().addClass("stats").addClass("stats--book");const c=[],d=a.subclasses[0].subclassFeatures.length,e=this._pageFilter.filterBox.getValues(),g=MiscUtil.getWalker({keyBlacklist:MiscUtil.GENERIC_WALKER_ENTRIES_KEY_BLACKLIST,isAllowDeleteObjects:!0});for(let f=0;f<d;++f){const b=f==d-1;c.push(`<div class="flex ${b?"mb-4":""}">`),a.subclasses.filter(a=>!ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"subclass",a.source)).forEach((b,d)=>{const h=ClassesPage.getSubclassCssMod(a,b);c.push(`<div class="mx-2 no-shrink cls-comp__wrp-features cls-main__sc-feature ${h?`cls-main__sc-feature--${h}`:""}" data-cls-comp-sc-ix="${d}">`),b.subclassFeatures[f].forEach(a=>{const b=MiscUtil.copy(a);g.walk(b,{object:a=>a.source?this._pageFilter.filterBox.toDisplay(e,a)?a:void 0:a}),Renderer.get().recursiveRender(b,c)}),c.push(`</div>`)}),c.push(`</div>`),b||c.push(`<hr class="hr-2 mt-3 cls-comp__hr-level"/>`)}b.append(c.join(""));let h=0;return a.subclasses.filter(a=>!ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"subclass",a.source)).forEach((a,c)=>{const d=UrlUtil.getStateKeySubclass(a);this._state[d]?h++:b.find(`[data-cls-comp-sc-ix="${c}"]`).hide()}),h||b.find(".cls-comp__hr-level").addClass("hidden"),h}});const b=async()=>{await this._pLock("sc-comparison "),this._state.isViewActiveScComp?await this._subclassComparisonView.pOpen():(this._subclassComparisonView.teardown(),document.title=`${a?a.name:"Classes"} - 5etools`),this._unlock("sc-comparison ")};this._addHookBase("isViewActiveScComp",b),b(),this._classBookView&&this._classBookView.cleanup(),this._classBookView=new ClassesPage.ClassBookView(this);const c=()=>{this._state.isViewActiveBook?this._classBookView.open():(this._classBookView.teardown(),document.title=`${a?a.name:"Classes"} - 5etools`)};this._addHookBase("isViewActiveBook",c),c()}static getSubclassCssMod(a,b){return b.source===a.source?"fresh":BrewUtil.hasSourceJson(b.source)?"brew":SourceUtil.isNonstandardSource(b.source)?b.isReprinted?"stale":"spicy":b.isReprinted?"reprinted":"fresh"}_render_renderClassContent(){const a=$(`#pagecontent`).empty(),b=this._dataList[this._classId._];if(this._outlineData={},this._$trsContent=[],a.append(Renderer.utils.getBorderTr()),b.fluff){const c=[];let d="";Renderer.get().setFirstSection(!0),b.fluff.forEach(a=>{const e=MiscUtil.copy(a);"string"!=typeof e&&a.source&&a.source!==b.source&&e.entries&&e.entries.unshift(`{@note The following information is from ${Parser.sourceJsonToFull(a.source)}${Renderer.utils.isDisplayPage(a.page)?`, page ${a.page}`:""}.}`),d+=Renderer.get().setDepthTracker(c).render(e)});const e=$(`<tr class="cls-main__cls-fluff"><td colspan="6"/></tr>`).fastSetHtml(d).appendTo(a);this._$trsContent.push(e),this._trackOutlineFluffData(c)}let c=0;b.classFeatures.forEach((d,e)=>{d.forEach((d,f)=>{const g=[],h=$(`<tr data-scroll-id="${e}-${f}" data-feature-type="class" class="${d.gainSubclassFeature?"cls-main__gain-sc-feature":""} cls-main__linked-titles"><td colspan="6"/></tr>`).fastSetHtml(Renderer.get().setDepthTracker(g).render(d)).appendTo(a);this._$trsContent.push(h),this._trackOutlineCfData(e,f,g),d.gainSubclassFeature&&(h.attr("data-feature-type","gain-subclass"),b.subclasses.forEach(d=>{const e=UrlUtil.getStateKeySubclass(d),f=`cls-main__sc-feature--${ClassesPage.getSubclassCssMod(b,d)}`,g=d.subclassFeatures[c];g&&g.forEach((b,g)=>{const h=[],i=0===c&&SourceUtil.isNonstandardSource(d.source)&&Parser.sourceJsonToDate(d.source)?Renderer.get().render(`{@note This subclass was published on ${MiscUtil.dateToStr(new Date(Parser.sourceJsonToDate(d.source)))}.}`):"",j=i&&b.entries?MiscUtil.copy(b):b;i&&j.entries&&j.entries.unshift(i);const k=$(`<tr class="cls-main__sc-feature ${f}" data-subclass-id="${UrlUtil.getStateKeySubclass(d)}"><td colspan="6"/></tr>`).fastSetHtml(Renderer.get().setDepthTracker(h).render(j)).appendTo(a);this._$trsContent.push(k),this._trackOutlineScData(e,c,g,h)})}),c++)})}),this._$trNoContent=ClassesPage._render_$getTrNoContent().appendTo(a),a.append(Renderer.utils.getBorderTr())}async pDeleteSubclassBrew(a,b){b.classSource=b.classSource||SRC_PHB;const c=this._dataList.find(a=>a.name.toLowerCase()===b.className.toLowerCase()&&a.source.toLowerCase()===b.classSource.toLowerCase());if(!c)return void setTimeout(()=>{throw new Error(`Could not find class "${b.className}" with source "${b.classSource}" to delete subclass "${b.name}" from!`)});const d=c.subclasses.findIndex(b=>b.uniqueId===a);if(~d){c.subclasses.splice(d,1),this._listSubclass&&this._listSubclass.removeItemByData("uniqueId",a);const e=UrlUtil.getStateKeySubclass(b);this._state[e]=!1}}static _render_$getTrNoContent(){return $(`<tr class="cls-main__msg-no-content"><td colspan="6">Toggle a button to view class and subclass information</td></tr>`)}_getDefaultState(){return MiscUtil.copy(ClassesPage._DEFAULT_STATE)}}ClassesPage._SC_FILTER_NAMESPACE="sctabs",ClassesPage._DEFAULT_STATE={feature:null,isHideSidebar:!1,isHideFeatures:!1,isShowFluff:!1,isShowScSources:!1,isViewActiveScComp:!1,isViewActiveBook:!1,isHideOutline:!1},ClassesPage.ClassBookView=class{constructor(a){this._classPage=a,this._parent=a.getPod(),this._bookViewActive=!1,this._hooks={},this._$body=null,this._$wrpBook=null,$(`#btn-readmode`).off("click").on("click",()=>this._parent.set("isViewActiveBook",!0))}cleanup(){Object.entries(this._hooks).forEach(([a,b])=>{b.forEach(b=>this._parent.removeHook(a,b))})}open(){if(this._bookViewActive)return;this._bookViewActive=!0;const a=this._classPage.activeClass;this._$body=$(document.body),this._$wrpBook=$(`<div class="bkmv"/>`),this._$body.css("overflow","hidden"),this._$body.addClass("bkmv-active");const b=$(`<span class="delete-icon glyphicon glyphicon-remove"/>`).click(()=>this._parent.set("isViewActiveBook",!1));$$`<div class="bkmv__spacer-name flex-h-right no-shrink">${b}</div>`.appendTo(this._$wrpBook);const c=$(`<div class="cls-bkmv__wrp-tabs flex-h-center"/>`).appendTo(this._$wrpBook),d=$(`<table class="stats stats--book stats--book-large"/>`);$$`<div class="flex-col overflow-y-auto container">${d}</div>`.appendTo(this._$wrpBook);const e=[];Renderer.get().setFirstSection(!0),e.push(`<tr><td colspan="6" class="py-3 px-5">`),Renderer.get().recursiveRender({type:"section",name:a.name},e),e.push(`</td></tr>`),e.push(`<tr class="text" data-cls-book-fluff="true"><td colspan="6" class="py-3 px-5">`),Renderer.get().setFirstSection(!0),(a.fluff||[]).forEach((b,c)=>{b=MiscUtil.copy(b),0===c&&b.name&&b.name.toLowerCase()===a.name.toLowerCase()&&delete b.name,b.source&&b.source!==a.source&&b.entries&&b.entries.unshift(`{@note The following information is from ${Parser.sourceJsonToFull(b.source)}${Renderer.utils.isDisplayPage(b.page)?`, page ${b.page}`:""}.}`),Renderer.get().recursiveRender(b,e)}),e.push(`</td></tr>`),e.push(`<tr class="text" data-cls-book-cf="true"><td colspan="6" class="py-3 px-5">`),a.classFeatures.forEach(a=>{a.forEach(a=>Renderer.get().recursiveRender(a,e))}),e.push(`</td></tr>`),a.subclasses.filter(a=>!ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"subclass",a.source)).forEach((b,c)=>{const d=ClassesPage.getSubclassCssMod(a,b);e.push(`<tr data-cls-book-sc-ix="${c}" class="cls-main__sc-feature ${d?`cls-main__sc-feature--${d}`:""}"><td colspan="6" class="py-3 px-5">`),b.subclassFeatures.forEach(a=>{a.forEach(a=>Renderer.get().recursiveRender(a,e))}),e.push(`</td></tr>`)}),e.push(Renderer.utils.getBorderTr()),d.append(e.join(""));const g=$(`<span class="cls-bkmv__btn-tab">Features</span>`).on("click",()=>{this._parent.set("isHideFeatures",!this._parent.get("isHideFeatures"))}),h=$(`<span class="cls-bkmv__btn-tab">Info</span>`).on("click",()=>{this._parent.set("isShowFluff",!this._parent.get("isShowFluff"))});this._parent.get("isHideFeatures")&&this._parent.set("isHideFeatures",!1),this._parent.get("isShowFluff")||this._parent.set("isShowFluff",!0),c.append(g),c.append(h);const j=this._classPage.filterBox.getValues();a.subclasses.filter(a=>!ExcludeUtil.isExcluded(UrlUtil.URL_TO_HASH_BUILDER[UrlUtil.PG_CLASSES](a),"subclass",a.source)).forEach((b,d)=>{const e=b.isReprinted?`${ClassesPage.getBaseShortName(b)} (${Parser.sourceJsonToAbv(b.source)})`:b.shortName,f=ClassesPage.getSubclassCssMod(a,b),g=UrlUtil.getStateKeySubclass(b),h=$(`<span class="cls-bkmv__btn-tab ${b.isReprinted?"cls__btn-sc--reprinted":""}" title="${ClassesPage.getBtnTitleSubclass(b)}">${e}</span>`).on("click",()=>this._parent.set(g,!this._parent.get(g))),i=this._classPage.filterBox.toDisplay(j,b.source,b._fMisc);i||h.addClass("hidden");const k=()=>{const a=this._$wrpBook.find(`[data-cls-book-sc-ix="${d}"]`),b=!!this._parent.get(g);h.toggleClass(`cls__btn-sc--active-${f}`,b),a.toggleClass("hidden",!b)};(this._hooks[g]=this._hooks[g]||[]).push(k),this._parent.addHook(g,k),k(),c.append(h)});const k=()=>{const a=this._$wrpBook.find(`[data-cls-book-cf="true"]`),b=!this._parent.get("isHideFeatures");g.toggleClass("cls__btn-cf--active",b),a.toggleClass("hidden",!b)};(this._hooks.isHideFeatures=this._hooks.isHideFeatures||[]).push(k),this._parent.addHook("isHideFeatures",k),k();const l=()=>{const a=this._$wrpBook.find(`[data-cls-book-fluff="true"]`),b=!this._parent.get("isShowFluff");h.toggleClass("active",!b),a.toggleClass("hidden",!!b)};(this._hooks.isShowFluff=this._hooks.isShowFluff||[]).push(l),this._parent.addHook("isShowFluff",l),l();const m=this._classPage.filterBox.getValues();this._$wrpBook.find(`tr`).each((a,b)=>{const c=$(b);c.find(`[data-source]`).each((a,b)=>{const c=b.dataset.source;$(b).toggleClass("hidden",!this._classPage.filterBox.toDisplay(m,c,[]))})}),this._$body.append(this._$wrpBook)}teardown(){this._bookViewActive&&(this._$body.css("overflow",""),this._$body.removeClass("bkmv-active"),this._$wrpBook.remove(),this._bookViewActive=!1)}};const classesPage=new ClassesPage;window.addEventListener("load",()=>classesPage.pOnLoad());